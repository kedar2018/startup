<div class="container py-4">
  <h1 class="h4 mb-3">Search</h1>

  <%= form_with url: search_path, method: :get, local: true, class: "row g-2 mb-4" do %>
    <div class="col-sm-10">
      <input type="search" name="q" value="<%= h(@q) %>" class="form-control form-control-lg" placeholder="Search blog, products, services…" autofocus>
    </div>
    <div class="col-sm-2 d-grid">
      <button class="btn btn-primary btn-lg">Search</button>
    </div>
  <% end %>

  <% unless @q.present? %>
    <p class="text-muted">Type a word and press Search.</p>
    <% return %>
  <% end %>

  <% total = @blogs.size + @products.size + @services.size %>
  <p class="small text-muted mb-3"><%= total %> result<%= 's' unless total == 1 %> for “<%= h(@q) %>”</p>

  <%# --- Blog --- %>
  <h2 class="h6 mt-4">Blog</h2>
  <% if @blogs.any? %>
    <ul class="list-unstyled">
      <% @blogs.each do |p| %>
        <li class="mb-2">
          <%= link_to p.title, (respond_to?(:post_path) ? post_path(p) : "/posts/#{p.id}") %><br>
          <small class="text-muted"><%= highlight(truncate(strip_tags(p.try(:body).to_s), length: 160), @q) %></small>
        </li>
      <% end %>
    </ul>
  <% else %>
    <div class="text-muted">No blog matches.</div>
  <% end %>

  <%# --- Products --- %>
  <h2 class="h6 mt-4">Products</h2>
  <% if @products.any? %>
    <ul class="list-unstyled">
      <% @products.each do |p| %>
        <li class="mb-2">
          <%= link_to p.title, (respond_to?(:product_path) ? product_path(p) : "/products/#{p.id}") %><br>
          <small class="text-muted">
            <%= highlight(truncate(strip_tags([p.description, p.content].compact.join(" ")), length: 160), @q) %>
          </small>
        </li>
      <% end %>
    </ul>
  <% else %>
    <div class="text-muted">No product matches.</div>
  <% end %>

  <%# --- Services --- %>
  <h2 class="h6 mt-4">Services</h2>
  <% if @services.any? %>
    <ul class="list-unstyled">
      <% @services.each do |s| %>
        <li class="mb-2">
          <%= link_to s.title, (respond_to?(:service_path) ? service_path(s) : "/services/#{s.id}") %><br>
          <small class="text-muted">
            <%= highlight(truncate(strip_tags([s.description, s.content].compact.join(" ")), length: 160), @q) %>
          </small>
        </li>
      <% end %>
    </ul>
  <% else %>
    <div class="text-muted">No service matches.</div>
  <% end %>
</div>
